---
import { APP_SCHEME_QUIZ_PREFIX, GOOGLE_PLAY_URL } from "../config/site";

interface Props {
    lang: "tr" | "en";
}

const { lang } = Astro.props;
const isEnglish = lang === "en";

const ui = {
    title: isEnglish ? "Open in Kafadar App" : "Kafadar Uygulamasında Aç",
    description: isEnglish
        ? "If the app does not open automatically, use the button below or install the app from stores."
        : "Uygulama otomatik açılmazsa aşağıdaki butonu kullanın veya mağazalardan uygulamayı yükleyin.",
    openApp: isEnglish ? "Open App" : "Uygulamayı Aç",
    appStore: isEnglish ? "App Store" : "App Store",
    playStore: isEnglish ? "Google Play" : "Google Play",
    statusWaiting: isEnglish
        ? "Trying to open the app..."
        : "Uygulama açılmaya çalışılıyor...",
    statusFallback: isEnglish
        ? "If nothing happened, install the app from the store buttons."
        : "Herhangi bir şey olmadıysa mağaza butonlarını kullanarak uygulamayı yükleyin.",
};
---

<section class="min-h-screen bg-gray-50 flex items-center justify-center px-4">
    <div
        class="w-full max-w-2xl bg-white rounded-3xl shadow-xl border border-gray-100 p-8 md:p-10"
    >
        <div class="flex items-center gap-3 mb-6">
            <img
                src="/logo.png"
                alt="Kafadar Logo"
                class="w-12 h-12 rounded-xl"
            />
            <h1 class="text-2xl md:text-3xl font-bold text-gray-900">
                {ui.title}
            </h1>
        </div>

        <p class="text-gray-600 mb-6">{ui.description}</p>
        <p
            id="deeplink-status"
            class="text-sm text-primary-700 font-medium mb-6"
        >
            {ui.statusWaiting}
        </p>

        <div class="flex flex-col sm:flex-row gap-4 items-center mb-8">
            <a
                id="open-app-link"
                href={APP_SCHEME_QUIZ_PREFIX}
                class="w-full sm:w-auto h-[3.6rem] inline-flex items-center justify-center rounded-xl bg-primary-600 px-8 text-white font-bold text-lg hover:bg-primary-700 hover:-translate-y-1 transition-all shadow-lg shadow-primary-500/30"
            >
                {ui.openApp}
            </a>
            <a
                href="javascript:void(0);"
                class="h-10 opacity-60 grayscale cursor-not-allowed hover:opacity-80 transition-opacity"
                onclick="alert(this.dataset.msg);"
                data-msg={isEnglish
                    ? "Coming soon to App Store!"
                    : "Çok yakında App Store'da!"}
            >
                <img
                    src={isEnglish
                        ? "https://tools.applemediaservices.com/api/badges/download-on-the-app-store/black/en-us?size=250x83&releaseDate=1276560000&h=7e7b68fad19738b5649a1bfb78ff46e9"
                        : "https://tools.applemediaservices.com/api/badges/download-on-the-app-store/black/tr-tr?size=250x83&releaseDate=1276560000&h=c3623512b9dcd8d9e6eb1b162f4ba6e9"}
                    alt="Download on the App Store"
                    class="h-full object-contain"
                />
            </a>
            <a
                href={GOOGLE_PLAY_URL}
                target="_blank"
                rel="noopener noreferrer"
                class="h-[4.5rem] md:h-20 hover:-translate-y-1 transition-transform"
            >
                <img
                    src={isEnglish
                        ? "https://play.google.com/intl/en_us/badges/static/images/badges/en_badge_web_generic.png"
                        : "https://play.google.com/intl/en_us/badges/static/images/badges/tr_badge_web_generic.png"}
                    alt="Get it on Google Play"
                    class="h-full object-contain"
                />
            </a>
        </div>
    </div>
</section>

<script is:inline define:vars={{ APP_SCHEME_QUIZ_PREFIX, ui }}>
    const params = new URLSearchParams(window.location.search);
    const slug = params.get("slug")?.trim();
    const openButton = document.getElementById("open-app-link");
    const statusNode = document.getElementById("deeplink-status");

    const deepLink = slug
        ? `${APP_SCHEME_QUIZ_PREFIX}${encodeURIComponent(slug)}`
        : APP_SCHEME_QUIZ_PREFIX;

    if (openButton instanceof HTMLAnchorElement) {
        openButton.href = deepLink;
    }

    window.setTimeout(() => {
        window.location.href = deepLink;
    }, 250);

    window.setTimeout(() => {
        if (statusNode) {
            statusNode.textContent = ui.statusFallback;
        }
    }, 1600);
</script>
