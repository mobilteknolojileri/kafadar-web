---
import {
    APP_SCHEME_QUIZ_PREFIX,
    APP_STORE_URL,
    DEEP_LINK_PREFIX,
    GOOGLE_PLAY_URL,
    LEGACY_DEEP_LINK_PREFIX,
} from "../config/site";

interface Props {
    lang: "tr" | "en";
}

const { lang } = Astro.props;
const isEnglish = lang === "en";

const ui = {
    title: isEnglish ? "Open in Kafadar App" : "Kafadar Uygulamasında Aç",
    description: isEnglish
        ? "If the app does not open automatically, use the button below or install the app from stores."
        : "Uygulama otomatik açılmazsa aşağıdaki butonu kullanın veya mağazalardan uygulamayı yükleyin.",
    openApp: isEnglish ? "Open App" : "Uygulamayı Aç",
    appStore: isEnglish ? "App Store" : "App Store",
    playStore: isEnglish ? "Google Play" : "Google Play",
    statusWaiting: isEnglish
        ? "Trying to open the app..."
        : "Uygulama açılmaya çalışılıyor...",
    statusFallback: isEnglish
        ? "If nothing happened, install the app from the store buttons."
        : "Herhangi bir şey olmadıysa mağaza butonlarını kullanarak uygulamayı yükleyin.",
    deepLinkLabel: isEnglish ? "Supported deep-link formats:" : "Desteklenen deep-link formatları:",
};
---

<section class="min-h-screen bg-gray-50 flex items-center justify-center px-4">
    <div
        class="w-full max-w-2xl bg-white rounded-3xl shadow-xl border border-gray-100 p-8 md:p-10"
    >
        <div class="flex items-center gap-3 mb-6">
            <img src="/logo.png" alt="Kafadar Logo" class="w-12 h-12 rounded-xl" />
            <h1 class="text-2xl md:text-3xl font-bold text-gray-900">{ui.title}</h1>
        </div>

        <p class="text-gray-600 mb-6">{ui.description}</p>
        <p id="deeplink-status" class="text-sm text-primary-700 font-medium mb-6">
            {ui.statusWaiting}
        </p>

        <div class="flex flex-col sm:flex-row gap-3 mb-8">
            <a
                id="open-app-link"
                href={APP_SCHEME_QUIZ_PREFIX}
                class="inline-flex items-center justify-center rounded-xl bg-primary-600 px-5 py-3 text-white font-semibold hover:bg-primary-700 transition-colors"
            >
                {ui.openApp}
            </a>
            <a
                href={APP_STORE_URL}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center justify-center rounded-xl border border-gray-300 px-5 py-3 font-semibold text-gray-700 hover:bg-gray-50 transition-colors"
            >
                {ui.appStore}
            </a>
            <a
                href={GOOGLE_PLAY_URL}
                target="_blank"
                rel="noopener noreferrer"
                class="inline-flex items-center justify-center rounded-xl border border-gray-300 px-5 py-3 font-semibold text-gray-700 hover:bg-gray-50 transition-colors"
            >
                {ui.playStore}
            </a>
        </div>

        <div class="rounded-2xl bg-gray-900 text-gray-100 p-5 text-sm space-y-2">
            <p class="font-semibold">{ui.deepLinkLabel}</p>
            <p>{DEEP_LINK_PREFIX}{"{quizId}"}</p>
            <p>{LEGACY_DEEP_LINK_PREFIX}{"{quizId}"}</p>
        </div>
    </div>
</section>

<script is:inline define:vars={{ APP_SCHEME_QUIZ_PREFIX, ui }}>
    const params = new URLSearchParams(window.location.search);
    const slug = params.get("slug")?.trim();
    const openButton = document.getElementById("open-app-link");
    const statusNode = document.getElementById("deeplink-status");

    const deepLink = slug
        ? `${APP_SCHEME_QUIZ_PREFIX}${encodeURIComponent(slug)}`
        : APP_SCHEME_QUIZ_PREFIX;

    if (openButton instanceof HTMLAnchorElement) {
        openButton.href = deepLink;
    }

    window.setTimeout(() => {
        window.location.href = deepLink;
    }, 250);

    window.setTimeout(() => {
        if (statusNode) {
            statusNode.textContent = ui.statusFallback;
        }
    }, 1600);
</script>
